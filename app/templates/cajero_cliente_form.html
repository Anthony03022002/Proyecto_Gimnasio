{% extends "base_admin.html" %}
{% block title %}Editar cliente{% endblock %}


{% block header %}
<header class="h-20 bg-surface-dark/50 backdrop-blur-md px-5 md:px-8 flex items-center justify-between sticky top-0 z-10 border-b border-white/5">
  <div class="flex items-center gap-3">
    <button
      type="button"
      class="md:hidden p-2 rounded-lg hover:bg-white/5 text-secondary hover:text-white transition-colors"
      onclick="openDrawer()"
      aria-label="Abrir menú"
    >
      <span class="material-symbols-outlined">menu</span>
    </button>

    <div>
      <h2 class="text-xl md:text-2xl font-bold text-white">Editar Clientes</h2>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}

{% set active = "cajero_clientes" %}

<div class="max-w-4xl mx-auto px-6 md:px-8 py-6 space-y-6">

  {# Header #}
  <div class="flex items-start justify-between gap-4">
    <div>
      <h4 class="text-[rgba(255,255,255,0.6)] mt-1">Actualiza la información del cliente</h4>
    </div>

    <a
      href="{{ url_for('web.cajero_clientes') }}"
      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
             bg-white/5 hover:bg-white/10 border border-[rgba(255,255,255,0.06)]
             text-sm font-semibold text-white transition-colors"
    >
      <span class="material-symbols-outlined text-sm">arrow_back</span>
      Volver
    </a>
  </div>

  {# Card #}
  <div class="bg-[rgba(35,37,39,0.92)] border border-[rgba(255,255,255,0.06)] rounded-2xl shadow-sm overflow-hidden">
    <div class="p-6">

      <form method="post" action="{{ url_for('web.cajero_cliente_editar_post', cliente_id=cliente._id) }}">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Nombre</label>
            <input
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="nombre"
              value="{{ cliente.nombre or '' }}"
              required
            >
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Apellido</label>
            <input
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="apellido"
              value="{{ cliente.apellido or '' }}"
            >
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Nickname</label>
            <input
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="nickname"
              value="{{ cliente.nickname or '' }}"
              placeholder="Ej: tony"
            >
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Sexo</label>
            <select
              name="sexo"
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
            >
              {% set sx = (cliente.sexo or '')|upper %}
              <option value="" {% if sx == '' %}selected{% endif %}>Seleccionar…</option>
              <option value="M" {% if sx == 'M' %}selected{% endif %}>Masculino (M)</option>
              <option value="F" {% if sx == 'F' %}selected{% endif %}>Femenino (F)</option>
            </select>
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Identificación</label>
            <input
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="identificacion"
              value="{{ cliente.identificacion or '' }}"
            >
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Fecha de nacimiento</label>

            {% set fn = cliente.fecha_nacimiento %}
            {% set fn_ymd = '' %}
            {% if fn %}
              {% if fn is string %}
                {% set fn_ymd = fn[:10] %}
              {% else %}
                {% set fn_ymd = fn.strftime('%Y-%m-%d') %}
              {% endif %}
            {% endif %}

            <input
              type="date"
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="fecha_nacimiento"
              value="{{ fn_ymd }}"
            >
          </div>


          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Email</label>
            <input
              type="email"
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="email"
              value="{{ cliente.email or '' }}"
            >
          </div>

          <div>
            <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Teléfono</label>
            <input
              class="mt-1 w-full px-4 py-2.5 rounded-xl
                    bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                    text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                    outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
              name="telefono"
              value="{{ cliente.telefono or '' }}"
            >
          </div>

          <!-- Contacto de emergencia -->
          <div class="md:col-span-2 mt-2">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-outlined text-primary text-base">health_and_safety</span>
              <p class="text-sm font-semibold text-[rgba(255,255,255,0.85)]">Contacto de emergencia</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Nombre</label>
                <input
                  class="mt-1 w-full px-4 py-2.5 rounded-xl
                        bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                        text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                        outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
                  name="contacto_emergencia_nombre"
                  value="{{ (cliente.contacto_emergencia.nombre if cliente.contacto_emergencia else '') or '' }}"
                  placeholder="Ej: emergencia"
                >
              </div>

              <div>
                <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Teléfono</label>
                <input
                  class="mt-1 w-full px-4 py-2.5 rounded-xl
                        bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                        text-[rgba(255,255,255,0.92)] placeholder:text-[rgba(255,255,255,0.45)]
                        outline-none focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
                  name="contacto_emergencia_telefono"
                  value="{{ (cliente.contacto_emergencia.telefono if cliente.contacto_emergencia else '') or '' }}"
                  placeholder="Ej: 0987..."
                >
              </div>
            </div>
          </div>

          {# Activo #}
          <div class="md:col-span-2 pt-2">
            <label class="inline-flex items-center gap-3 cursor-pointer select-none">
              <input
                class="h-4 w-4 rounded border-[rgba(255,255,255,0.12)] bg-[rgba(255,255,255,0.02)]
                      text-accent focus:ring-accent/40"
                type="checkbox"
                name="activo"
                id="activo"
                {% if user_activo %}checked{% endif %}
              >
              <span class="text-sm font-medium text-[rgba(255,255,255,0.92)]">Activo</span>
              <span class="text-xs text-[rgba(255,255,255,0.45)]">Permite iniciar sesión al cliente</span>
            </label>
          </div>

        </div>

        <div class="flex justify-end mt-6 pt-5 border-t border-[rgba(255,255,255,0.07)]">
          <button
            class="px-4 py-2 rounded-lg bg-accent hover:bg-accent/90
                  text-sm font-semibold text-white transition-colors"
            type="submit"
          >
            Guardar cambios
          </button>
        </div>
      </form>


    </div>
  </div>

</div>

{% endblock %}
