{% extends "base_admin.html" %}
{% block title %}Mis alumnos{% endblock %}
{% set active = "entrenador_alumnos" %}

{% block header %}
  {% set entrenador_nombre = (entrenador.nombre or entrenador.username) if entrenador is defined else (session.get("username") or "Entrenador") %}
  <header class="h-20 bg-surface-dark/50 backdrop-blur-md px-5 md:px-8 flex items-center justify-between sticky top-0 z-10 border-b border-white/5">
    <div class="flex items-center gap-3 min-w-0">
      <button
        type="button"
        class="md:hidden p-2 rounded-lg hover:bg-white/5 text-secondary hover:text-white transition-colors"
        onclick="openDrawer()"
        aria-label="Abrir menú"
      >
        <span class="material-symbols-outlined">menu</span>
      </button>

      <div class="min-w-0">
        <h2 class="text-xl md:text-2xl font-bold text-white truncate">
          Mis alumnos
        </h2>
        <p class="text-xs text-secondary mt-0.5">Alumnos que han reservado contigo</p>
      </div>
    </div>
  </header>
{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto px-6 md:px-8 py-6">
  <div class="flex justify-center">
    <div class="w-full max-w-6xl space-y-6">

      <div class="bg-surface-dark rounded-2xl shadow-sm border border-white/5 overflow-hidden">
        <div class="p-6 border-b border-white/5 flex items-center justify-between gap-3">
          <div>
            <h3 class="text-lg font-bold text-white flex items-center gap-2">
              <span class="material-symbols-outlined text-accent">groups</span>
              Alumnos
            </h3>
            <p class="text-xs text-secondary mt-1">Listado de alumnos con reservas</p>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead class="bg-white/5">
              <tr>
                <th class="px-8 py-4 text-xs font-bold text-accent uppercase tracking-wider">Alumno</th>
                <th class="px-8 py-4 text-xs font-bold text-accent uppercase tracking-wider">Teléfono</th>
                <th class="px-8 py-4 text-xs font-bold text-accent uppercase tracking-wider text-center w-[120px]">Reservas</th>
                <th class="px-8 py-4 text-xs font-bold text-accent uppercase tracking-wider w-[220px]">Planificación</th>
                <th class="px-8 py-4 text-xs font-bold text-accent uppercase tracking-wider text-right w-[240px]">Acción</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-white/5">
              {% if alumnos %}
                {% for a in alumnos %}
                  {% set nombre = (a.nombre ~ ' ' ~ a.apellido)|trim %}
                  <tr class="hover:bg-white/[0.03] transition-colors">
                    <td class="px-8 py-4">
                      <div class="text-sm text-white font-semibold">
                        {{ nombre if nombre else a._id }}
                      </div>
                    </td>

                    <td class="px-8 py-4 text-sm text-secondary">
                      {{ a.telefono or '-' }}
                    </td>

                    <td class="px-8 py-4 text-center">
                      <span class="inline-flex items-center justify-center min-w-[34px] px-3 py-1 rounded-full text-[11px] font-bold text-white bg-white/10 border border-white/10">
                        {{ a.total_reservas or 0 }}
                      </span>
                    </td>

                    <td class="px-8 py-4">
                      {% if a.plan_filename %}
                        <div class="flex items-center gap-2">
                          <span class="inline-flex items-center gap-2 text-[11px] font-bold text-green-200 bg-green-500/10 px-3 py-1 rounded-full border border-green-500/20">
                            Subida
                          </span>
                          <span class="text-xs text-secondary truncate max-w-[240px]">
                            {{ a.plan_filename }}
                          </span>
                        </div>
                      {% else %}
                        <span class="inline-flex items-center gap-2 text-[11px] font-bold text-secondary bg-white/5 px-3 py-1 rounded-full border border-white/10">
                          Sin plan
                        </span>
                      {% endif %}
                    </td>

                    <td class="px-8 py-4 text-right">
                      <div class="inline-flex flex-wrap justify-end gap-2">
                        <a
                          class="inline-flex items-center gap-2 px-3 py-2 rounded-lg
                                 bg-white/5 hover:bg-white/10 border border-white/10
                                 text-xs font-semibold text-white transition-colors"
                          href="{{ url_for('web.entrenador_alumno_detalle', cliente_id=a._id) }}"
                        >
                          <span class="material-symbols-outlined text-[18px]">manage_accounts</span>
                          Gestionar
                        </a>

                        {% if a.plan_id %}
                          <a
                            class="inline-flex items-center gap-2 px-3 py-2 rounded-lg
                                   bg-white/5 hover:bg-white/10 border border-white/10
                                   text-xs font-semibold text-white/90 transition-colors"
                            href="{{ url_for('web.descargar_planificacion', plan_id=a.plan_id) }}"
                          >
                            <span class="material-symbols-outlined text-[18px]">download</span>
                            Descargar
                          </a>
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td class="px-8 py-24 text-center" colspan="5">
                    <div class="flex flex-col items-center justify-center text-secondary/40">
                      <span class="material-symbols-outlined text-5xl mb-3">person_off</span>
                      <p class="text-sm font-medium">Aún no tienes alumnos con reservas.</p>
                    </div>
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>

        <div class="px-6 py-4 text-[11px] text-secondary border-t border-white/5">
          Consejo: usa “Gestionar” para ver el detalle del alumno y subir/actualizar planificación.
        </div>

      </div>

    </div>
  </div>
</div>

{% endblock %}
