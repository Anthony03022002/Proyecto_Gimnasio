{% extends "base.html" %}
{% block title %}Mis alumnos{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-0">Mis alumnos</h4>
    <div class="text-muted small">Alumnos que han reservado contigo</div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th>Alumno</th>
            <th>Teléfono</th>
            <th class="text-center">Reservas</th>
            <th>Planificación</th>
            <th class="text-end">Acción</th>
          </tr>
        </thead>
        <tbody>
          {% if alumnos %}
            {% for a in alumnos %}
              {% set nombre = (a.nombre ~ ' ' ~ a.apellido)|trim %}
              <tr>
                <td class="fw-semibold">{{ nombre if nombre else a._id }}</td>
                <td class="text-muted">{{ a.telefono or '-' }}</td>
                <td class="text-center">
                  <span class="badge bg-primary">{{ a.total_reservas or 0 }}</span>
                </td>
                <td>
                  {% if a.plan_filename %}
                    <span class="badge bg-success">Subida</span>
                    <span class="text-muted small ms-2">{{ a.plan_filename }}</span>
                  {% else %}
                    <span class="badge bg-secondary">Sin plan</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary"
                     href="{{ url_for('web.entrenador_alumno_detalle', cliente_id=a._id) }}">
                    Gestionar
                  </a>

                  {% if a.plan_id %}
                    <a class="btn btn-sm btn-outline-secondary"
                       href="{{ url_for('web.descargar_planificacion', plan_id=a.plan_id) }}">
                      Descargar
                    </a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-3">
                Aún no tienes alumnos con reservas.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
