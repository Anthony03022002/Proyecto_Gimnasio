{# templates/admin_horarios_crear.html #}
{% extends "base_admin.html" %}
{% block title %}Crear horario{% endblock %}
{% set active = "admin_horarios" %}

{% block header %}
<header class="h-20 bg-surface-dark/50 backdrop-blur-md px-5 md:px-8 flex items-center justify-between sticky top-0 z-10 border-b border-white/5">
  <div class="flex items-center gap-3">
    <button
      type="button"
      class="md:hidden p-2 rounded-lg hover:bg-white/5 text-secondary hover:text-white transition-colors"
      onclick="openDrawer()"
      aria-label="Abrir menú"
    >
      <span class="material-symbols-outlined">menu</span>
    </button>

    <div>
      <h2 class="text-xl md:text-2xl font-bold text-white">Crear horario</h2>
    </div>
  </div>

  <div class="flex items-center gap-2">
    <a
      href="{{ url_for('web.admin_horarios') }}"
      class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-sm font-semibold text-white transition-colors shrink-0"
      title="Volver"
    >
      <span class="material-symbols-outlined text-[20px]">arrow_back</span>
      <span class="hidden sm:inline">Volver</span>
    </a>
  </div>
</header>
{% endblock %}

{% block content %}

<style>
  /* Inputs time en dark (fix del icono + contraste) */
  input[type="time"]{
    color-scheme: dark;
  }
</style>

<div class="max-w-5xl mx-auto px-3 sm:px-0">

  <div class="bg-surface-dark rounded-2xl shadow-sm border border-white/5 overflow-hidden">
    <div class="p-6 border-b border-white/5">
      <h3 class="text-lg font-bold text-white">Datos del horario</h3>
      <p class="text-xs text-secondary mt-1">Ponle un nombre claro y define los rangos de horas.</p>
    </div>

    <div class="p-6">
      <form method="post" action="{{ url_for('web.admin_horarios_crear_post') }}" class="space-y-6">

        {# Nombre #}
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Nombre</label>
          <input
            type="text"
            name="nombre"
            required
            placeholder="Ej: Mañana + Tarde"
            class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white text-sm
                   placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-white/10 focus:border-white/20 transition-colors"
          >
          <p class="text-xs text-secondary mt-2">
            Tip: usa algo como <b>Mañana</b>, <b>Tarde</b> o <b>Mañana + Noche</b>.
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

          {# Bloque 1 #}
          <div class="rounded-2xl border border-white/10 bg-white/[0.03] p-5">
            <div class="flex items-center justify-between mb-4">
              <div>
                <div class="text-white font-bold">Bloque 1</div>
                <div class="text-xs text-secondary mt-1">Obligatorio</div>
              </div>
              <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[11px] font-bold bg-green-500/10 text-green-300 border border-green-500/20">
                <span class="material-symbols-outlined text-[16px]">check_circle</span>
                Activo
              </span>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-bold text-accent uppercase tracking-wider mb-2">Inicio</label>
                <input
                  type="time"
                  name="b1_ini"
                  value="05:00"
                  required
                  class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white text-sm
                         focus:outline-none focus:ring-2 focus:ring-white/10 focus:border-white/20 transition-colors"
                >
              </div>
              <div>
                <label class="block text-xs font-bold text-accent uppercase tracking-wider mb-2">Fin</label>
                <input
                  type="time"
                  name="b1_fin"
                  value="12:00"
                  required
                  class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white text-sm
                         focus:outline-none focus:ring-2 focus:ring-white/10 focus:border-white/20 transition-colors"
                >
              </div>
            </div>
          </div>

          {# Bloque 2 #}
          <div class="rounded-2xl border border-white/10 bg-white/[0.03] p-5">
            <div class="flex items-center justify-between mb-4">
              <div>
                <div class="text-white font-bold">Bloque 2</div>
                <div class="text-xs text-secondary mt-1">Opcional</div>
              </div>

              <button
                type="button"
                id="btnToggleB2"
                class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-red-500/10 hover:bg-red-500/15 border border-red-500/20 text-sm font-bold text-red-300 transition-colors"
              >
                <span class="material-symbols-outlined text-[20px]">toggle_off</span>
                Desactivar
              </button>
            </div>

            <div id="bloque2Fields">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs font-bold text-accent uppercase tracking-wider mb-2">Inicio</label>
                  <input
                    type="time"
                    name="b2_ini"
                    id="b2_ini"
                    value="15:00"
                    class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white text-sm
                           focus:outline-none focus:ring-2 focus:ring-white/10 focus:border-white/20 transition-colors"
                  >
                </div>
                <div>
                  <label class="block text-xs font-bold text-accent uppercase tracking-wider mb-2">Fin</label>
                  <input
                    type="time"
                    name="b2_fin"
                    id="b2_fin"
                    value="22:00"
                    class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white text-sm
                           focus:outline-none focus:ring-2 focus:ring-white/10 focus:border-white/20 transition-colors"
                  >
                </div>
              </div>

              <p class="text-xs text-secondary mt-3">
                Si no quieres este bloque, puedes desactivarlo y se guardará solo el Bloque 1.
              </p>
            </div>

            <div id="bloque2DisabledMsg" class="hidden">
              <div class="rounded-xl border border-white/10 bg-white/5 p-4">
                <div class="flex items-start gap-3">
                  <span class="material-symbols-outlined text-secondary">info</span>
                  <div>
                    <p class="text-sm text-white font-semibold">Bloque 2 desactivado</p>
                    <p class="text-xs text-secondary mt-1">Solo se guardará el Bloque 1.</p>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>

        {# Acciones #}
        <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
          <a
            href="{{ url_for('web.admin_horarios') }}"
            class="inline-flex justify-center items-center gap-2 px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-sm font-semibold text-white transition-colors"
          >
            <span class="material-symbols-outlined text-[20px]">close</span>
            Cancelar
          </a>

          <button
            class="inline-flex justify-center items-center gap-2 px-4 py-3 rounded-xl bg-primary hover:bg-[#2C3B43]
                   text-sm font-bold text-white transition-colors focus:outline-none focus:ring-2 focus:ring-white/10 active:scale-[0.99]"
            type="submit"
          >
            <span class="material-symbols-outlined text-[20px]">save</span>
            Guardar horario
          </button>
        </div>

      </form>
    </div>
  </div>

</div>

<script>
  (function () {
    const btn = document.getElementById("btnToggleB2");
    const fields = document.getElementById("bloque2Fields");
    const msg = document.getElementById("bloque2DisabledMsg");
    const b2Ini = document.getElementById("b2_ini");
    const b2Fin = document.getElementById("b2_fin");

    let enabled = true;

    function setEnabled(val) {
      enabled = val;

      if (!enabled) {
        fields.classList.add("hidden");
        msg.classList.remove("hidden");

        b2Ini.value = "";
        b2Fin.value = "";
        b2Ini.disabled = true;
        b2Fin.disabled = true;

        btn.className = "inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-green-500/10 hover:bg-green-500/15 border border-green-500/20 text-sm font-bold text-green-300 transition-colors";
        btn.innerHTML = '<span class="material-symbols-outlined text-[20px]">toggle_on</span> Activar';
      } else {
        fields.classList.remove("hidden");
        msg.classList.add("hidden");

        b2Ini.disabled = false;
        b2Fin.disabled = false;

        if (!b2Ini.value) b2Ini.value = "15:00";
        if (!b2Fin.value) b2Fin.value = "22:00";

        btn.className = "inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-red-500/10 hover:bg-red-500/15 border border-red-500/20 text-sm font-bold text-red-300 transition-colors";
        btn.innerHTML = '<span class="material-symbols-outlined text-[20px]">toggle_off</span> Desactivar';
      }
    }

    btn.addEventListener("click", () => setEnabled(!enabled));
  })();
</script>

{% endblock %}
