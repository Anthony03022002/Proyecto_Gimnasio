{% extends "base_admin.html" %}
{% block title %}Mis clientes{% endblock %}

{% block header %}
<header class="h-20 bg-surface-dark/50 backdrop-blur-md px-5 md:px-8 flex items-center justify-between sticky top-0 z-10 border-b border-white/5">

  {# IZQUIERDA: menú + título #}
  <div class="flex items-center gap-3">
    <button
      type="button"
      class="md:hidden p-2 rounded-lg hover:bg-white/5 text-secondary hover:text-white transition-colors"
      onclick="openDrawer()"
      aria-label="Abrir menú"
    >
      <span class="material-symbols-outlined">menu</span>
    </button>

    <div>
      <h2 class="text-xl md:text-2xl font-bold text-white">Clientes</h2>
      <p class="text-xs text-secondary mt-0.5">Clientes relacionados a tus ventas</p>
    </div>
  </div>

  {# DERECHA: botón #}
  <div class="flex items-center">
    <a
      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
             bg-white/5 hover:bg-white/10 border border-white/10
             text-sm font-semibold text-white transition-colors"
      href="{{ url_for('web.facturacion_nueva') }}"
    >
      <span class="material-symbols-outlined text-sm">add</span>
      Nueva venta
    </a>
  </div>

</header>
{% endblock %}



{% block content %}

<div class="max-w-6xl mx-auto px-6 md:px-8 py-6 space-y-6">

  {# Header #}
  <div class="flex items-center justify-between gap-3">

    
  </div>

  {# Tabla #}
  <div class="bg-[rgba(35,37,39,0.92)] border border-[rgba(255,255,255,0.06)] rounded-2xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-[rgba(255,255,255,0.05)]">
          <tr>
            <th class="px-6 py-4 text-xs font-bold text-accent uppercase tracking-wider">Nombre</th>
            <th class="px-6 py-4 text-xs font-bold text-accent uppercase tracking-wider">Usuario</th>
            <th class="px-6 py-4 text-xs font-bold text-accent uppercase tracking-wider">Teléfono</th>
            <th class="px-6 py-4 text-xs font-bold text-accent uppercase tracking-wider">Estado</th>
            <th class="px-6 py-4 text-xs font-bold text-accent uppercase tracking-wider text-right">Acciones</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-[rgba(255,255,255,0.07)]">
          {% if clientes %}
            {% for c in clientes %}
              <tr class="transition-colors hover:bg-[rgba(255,255,255,0.04)] odd:bg-[rgba(255,255,255,0.02)]">
                <td class="px-6 py-4">
                  <div class="text-sm font-semibold text-[rgba(255,255,255,0.92)]">{{ c.nombre }}</div>
                </td>

                <td class="px-6 py-4">
                  <div class="text-sm text-[rgba(255,255,255,0.6)]">{{ c.username }}</div>
                </td>

                <td class="px-6 py-4">
                  <div class="text-sm text-[rgba(255,255,255,0.6)]">{{ c.telefono or '-' }}</div>
                </td>

                <td class="px-6 py-4">
                  {% if c.user_activo %}
                    <span class="inline-flex items-center gap-2 text-[11px] font-bold text-green-300 bg-green-500/10 px-3 py-1 rounded-full border border-green-500/20">
                      ACTIVO
                    </span>
                  {% else %}
                    <span class="inline-flex items-center gap-2 text-[11px] font-bold text-red-300 bg-red-500/10 px-3 py-1 rounded-full border border-red-500/20">
                      INACTIVO
                    </span>
                  {% endif %}
                </td>

                <td class="px-6 py-4 text-right">
                  <div class="inline-flex items-center gap-2">
                    <a
                      class="p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10
                             text-white transition-colors"
                      href="{{ url_for('web.cajero_cliente_editar', cliente_id=c._id) }}"
                      title="Editar"
                    >
                      <span class="material-symbols-outlined text-[18px]">edit</span>
                    </a>

                    <button
                      type="button"
                      class="p-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10
                             text-white transition-colors"
                      data-bs-toggle="modal"
                      data-bs-target="#modalPwd{{ c._id }}"
                      title="Cambiar contraseña"
                    >
                      <span class="material-symbols-outlined text-[18px]">key</span>
                    </button>
                  </div>
                </td>
              </tr>

              {# MODAL (Bootstrap) pero oscuro y con tu paleta #}
              <div class="modal fade" id="modalPwd{{ c._id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content bg-[rgba(35,37,39,0.98)] border border-[rgba(255,255,255,0.10)] text-white">
                    <div class="modal-header border-[rgba(255,255,255,0.10)]">
                      <h5 class="modal-title text-white font-bold">
                        Cambiar contraseña
                      </h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <form method="post" action="{{ url_for('web.cajero_cliente_password', cliente_id=c._id) }}">
                      <div class="modal-body space-y-4">

                        <div>
                          <div class="text-xs text-[rgba(255,255,255,0.45)]">Cliente:</div>
                          <div class="text-sm font-semibold text-[rgba(255,255,255,0.92)]">
                            {{ c.nombre }}
                            <span class="text-[rgba(255,255,255,0.45)]">({{ c.username }})</span>
                          </div>
                        </div>

                        <div>
                          <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Nueva contraseña</label>
                          <input
                            class="mt-1 w-full px-4 py-2.5 rounded-xl
                                   bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                                   text-[rgba(255,255,255,0.92)] outline-none
                                   focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
                            type="password"
                            name="new_password"
                            minlength="6"
                            required
                          />
                          <div class="text-[11px] text-[rgba(255,255,255,0.45)] mt-1">Mínimo 6 caracteres.</div>
                        </div>

                        <div>
                          <label class="text-xs font-semibold text-[rgba(255,255,255,0.6)]">Confirmar</label>
                          <input
                            class="mt-1 w-full px-4 py-2.5 rounded-xl
                                   bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.06)]
                                   text-[rgba(255,255,255,0.92)] outline-none
                                   focus:ring-2 focus:ring-accent/40 focus:border-accent/60 transition"
                            type="password"
                            name="confirm_password"
                            minlength="6"
                            required
                          />
                        </div>

                        <div class="rounded-xl border border-yellow-500/20 bg-yellow-500/10 px-4 py-3 text-sm text-yellow-100">
                          <span class="material-symbols-outlined align-middle text-base mr-1">warning</span>
                          Al cliente se le pedirá cambiar la contraseña al iniciar sesión.
                        </div>
                      </div>

                      <div class="modal-footer border-[rgba(255,255,255,0.10)]">
                        <button
                          type="button"
                          class="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10
                                 text-sm font-semibold text-white transition-colors"
                          data-bs-dismiss="modal"
                        >
                          Cancelar
                        </button>
                        <button
                          type="submit"
                          class="px-4 py-2 rounded-lg bg-accent hover:bg-accent/90
                                 text-sm font-semibold text-white transition-colors"
                        >
                          Guardar
                        </button>
                      </div>
                    </form>

                  </div>
                </div>
              </div>

            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="px-6 py-20 text-center">
                <div class="flex flex-col items-center justify-center text-[rgba(255,255,255,0.45)]">
                  <span class="material-symbols-outlined text-5xl mb-3">group</span>
                  <p class="text-sm font-medium">Aún no tienes clientes (haz una venta para registrar).</p>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

</div>

{% endblock %}
