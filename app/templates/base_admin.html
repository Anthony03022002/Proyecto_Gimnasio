<!DOCTYPE html>
<html class="dark" lang="es">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>{% block title %}CORE Gym{% endblock %}</title>

    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='images/icono4.png') }}">
    <link rel="shortcut icon" type="image/jpeg" href="{{ url_for('static', filename='images/icono4.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icono4.png') }}">


    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>

    <!-- Bootstrap (solo 1 vez) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#3D4F5A",
              secondary: "#6B7B84",
              accent: "#A9ACA9",
              "background-light": "#E6E4DA",
              "background-dark": "#1a1c1e",
              surface: "#FFFFFF",
              "surface-dark": "#2d2f31",
            },
            fontFamily: { display: ["Inter", "sans-serif"] },
            borderRadius: { DEFAULT: "0.75rem" },
          },
        },
      };
    </script>

    <style type="text/tailwindcss">
      body { font-family: 'Inter', sans-serif; }
      .material-symbols-outlined { font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24; }

      .sidebar-item-active {
        background-color: rgba(255, 255, 255, 0.05);
        border-left: 4px solid #FFFFFF;
      }

      .select-core option,
      .select-core optgroup {
        color: #000000 !important;
      }

      .select-core { color-scheme: dark; }
    </style>

    {# Estilos del modal publicidad #}
    <style>
      .modal-publicidad .modal-dialog { max-width: 980px; }
      @media (max-width: 992px) {
        .modal-publicidad .modal-dialog { max-width: 95vw; margin: 1rem auto; }
      }
      .modal-publicidad-media{
        width: 100%;
        max-height: 72vh;
        object-fit: contain;
        background: #111;
        display: block;
      }
    </style>
  </head>

  <body class="bg-background-dark text-white transition-colors duration-200">
    <div class="flex h-screen overflow-hidden">
      {# Sidebar desktop #}
      <aside class="hidden md:flex w-64 bg-surface-dark border-r border-white/5 flex-col">
        {% include "partials/sidebar_admin.html" %}
      </aside>

      {# Contenido principal #}
      <main class="flex-1 overflow-y-auto bg-background-dark">
        {% block header %}{% endblock %}
        <div class="p-3 md:p-8 space-y-8">
          {% block content %}{% endblock %}
        </div>
      </main>

      {# Drawer móvil #}
      <div id="mobileDrawerOverlay" class="fixed inset-0 bg-black/60 z-40 hidden md:hidden"></div>

      <aside
        id="mobileDrawer"
        class="fixed inset-y-0 left-0 w-72 max-w-[85vw] bg-surface-dark border-r border-white/10 z-50
               -translate-x-full transition-transform duration-200 md:hidden flex flex-col"
        aria-hidden="true"
      >
        <div class="p-4 border-b border-white/10 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 bg-white flex items-center justify-center rounded-lg overflow-hidden">
              <img src="{{ url_for('static', filename='images/logo_gym.jpeg') }}" alt="Logo" class="w-full h-full object-cover" />
            </div>
            <div>
              <div class="font-bold text-white leading-tight">CORE</div>
              <div class="text-[10px] uppercase tracking-widest text-secondary font-semibold">Functional</div>
            </div>
          </div>

          <button
            type="button"
            class="p-2 rounded-lg hover:bg-white/5 text-secondary hover:text-white transition-colors"
            onclick="closeDrawer()"
            aria-label="Cerrar menú"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <div class="flex-1 overflow-y-auto">
          {% include "partials/sidebar_admin.html" %}
        </div>
      </aside>
    </div>
    {# ✅ FIN del contenedor principal. Todo lo demás va fuera. #}

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    {# =========================
       ✅ MODAL PUBLICIDAD (SOLO DASHBOARDS)
       ========================= #}
    {% if session.get("username") and publicidad_activa and show_publicidad %}
      {% set fn = (publicidad_activa.filename or "")|lower %}
      {% set is_video =
          (publicidad_activa.kind == "video")
          or fn.endswith(".mp4")
          or fn.endswith(".webm")
          or fn.endswith(".mov")
          or fn.endswith(".m4v")
          or fn.endswith(".avi")
      %}

      <div class="modal fade modal-publicidad" id="modalPublicidad" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h6 class="modal-title text-dark">
                <i class="bi bi-megaphone me-1"></i>
                {{ publicidad_activa.titulo or "Publicidad" }}
              </h6>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body p-0">
              {% if is_video %}
                <video
                  class="modal-publicidad-media"
                  src="{{ url_for('web.ver_publicidad_media', pub_id=publicidad_activa._id) }}"
                  controls
                  autoplay
                  muted
                  loop
                  playsinline
                  preload="metadata"
                ></video>
              {% else %}
                <img
                  src="{{ url_for('web.ver_publicidad_media', pub_id=publicidad_activa._id) }}"
                  alt="publicidad"
                  class="modal-publicidad-media"
                />
              {% endif %}
            </div>

            <div class="modal-footer">
              <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">
                Cerrar
              </button>
              <button class="btn btn-primary" type="button" id="btnNoMostrarPub">
                No mostrar de nuevo
              </button>
            </div>
          </div>
        </div>
      </div>

      <script>
        (function () {
          const pubId = "{{ publicidad_activa._id }}";
          const key = "pub_seen_" + pubId;

          if (!pubId) return;
          if (localStorage.getItem(key) === "1") return;

          const el = document.getElementById("modalPublicidad");
          if (!el || typeof bootstrap === "undefined") return;

          const modal = new bootstrap.Modal(el);

          window.addEventListener("load", () => {
            modal.show();
          });

          const btn = document.getElementById("btnNoMostrarPub");
          if (btn) {
            btn.addEventListener("click", () => {
              localStorage.setItem(key, "1");
              modal.hide();
            });
          }
        })();
      </script>
    {% endif %}

    <script>
      function openDrawer() {
        const overlay = document.getElementById("mobileDrawerOverlay");
        const drawer = document.getElementById("mobileDrawer");
        if (!overlay || !drawer) return;

        overlay.classList.remove("hidden");
        drawer.classList.remove("-translate-x-full");
        drawer.setAttribute("aria-hidden", "false");
      }

      function closeDrawer() {
        const overlay = document.getElementById("mobileDrawerOverlay");
        const drawer = document.getElementById("mobileDrawer");
        if (!overlay || !drawer) return;

        overlay.classList.add("hidden");
        drawer.classList.add("-translate-x-full");
        drawer.setAttribute("aria-hidden", "true");
      }

      (function () {
        const overlay = document.getElementById("mobileDrawerOverlay");
        if (overlay) overlay.addEventListener("click", closeDrawer);

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeDrawer();
        });
      })();
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
